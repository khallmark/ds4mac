// DS4ReportDescriptor.h — HID Report Descriptor for DualShock 4
// Defines the device as a Game Pad with sticks, D-pad, 14 buttons,
// analog triggers, and vendor-specific data (touchpad, IMU, battery).
// Originally from DS4/dualshock4hid.h (legacy KEXT), preserved for DriverKit.
//
// This descriptor is returned by DS4HIDDevice::newReportDescriptor() so that
// IOHIDFamily and GameController.framework recognize the device as a
// GCDualShockGamepad via the Sony VID/PID + standard gamepad usage page.
//
// Report structure:
//   Report ID 0x01 (Input):  4× 8-bit sticks + 4-bit hat + 14 buttons +
//                            6-bit vendor counter + 2× 8-bit triggers +
//                            54 bytes vendor data (IMU, touchpad, battery)
//   Report ID 0x05 (Output): 31 bytes vendor data (rumble, LED, audio)
//   Report IDs 0x02-0xB0, 0xF0-0xF2: Feature reports (calibration, config)

#ifndef DS4ReportDescriptor_h
#define DS4ReportDescriptor_h

static const unsigned char DS4ReportDescriptor[] = {
    0x05, 0x01,         // Usage Page (Generic Desktop Controls)
    0x09, 0x05,         // Usage (Game Pad)
    0xA1, 0x01,         // Collection (Application)
    0x85, 0x01,         //   Report ID (1)

    // Left Stick X, Left Stick Y, Right Stick X, Right Stick Z — 4 × 8-bit
    0x09, 0x30,         //   Usage (X)
    0x09, 0x31,         //   Usage (Y)
    0x09, 0x32,         //   Usage (Z)
    0x09, 0x35,         //   Usage (Rz)
    0x15, 0x00,         //   Logical Minimum (0)
    0x26, 0xFF, 0x00,   //   Logical Maximum (255)
    0x75, 0x08,         //   Report Size (8)
    0x95, 0x04,         //   Report Count (4)
    0x81, 0x02,         //   Input (Data,Var,Abs)

    // D-Pad — 4-bit hat switch (0-7 directions, 8=null)
    0x09, 0x39,         //   Usage (Hat switch)
    0x15, 0x00,         //   Logical Minimum (0)
    0x25, 0x07,         //   Logical Maximum (7)
    0x35, 0x00,         //   Physical Minimum (0)
    0x46, 0x3B, 0x01,   //   Physical Maximum (315)
    0x65, 0x14,         //   Unit (English Rotation: Degrees)
    0x75, 0x04,         //   Report Size (4)
    0x95, 0x01,         //   Report Count (1)
    0x81, 0x42,         //   Input (Data,Var,Abs,Null)

    // 14 Buttons — 14 × 1-bit
    0x65, 0x00,         //   Unit (None)
    0x05, 0x09,         //   Usage Page (Button)
    0x19, 0x01,         //   Usage Minimum (0x01)
    0x29, 0x0E,         //   Usage Maximum (0x0E)
    0x15, 0x00,         //   Logical Minimum (0)
    0x25, 0x01,         //   Logical Maximum (1)
    0x75, 0x01,         //   Report Size (1)
    0x95, 0x0E,         //   Report Count (14)
    0x81, 0x02,         //   Input (Data,Var,Abs)

    // Vendor counter — 6-bit (pads buttons to full bytes)
    0x06, 0x00, 0xFF,   //   Usage Page (Vendor Defined 0xFF00)
    0x09, 0x20,         //   Usage (0x20)
    0x75, 0x06,         //   Report Size (6)
    0x95, 0x01,         //   Report Count (1)
    0x15, 0x00,         //   Logical Minimum (0)
    0x25, 0x7F,         //   Logical Maximum (127)
    0x81, 0x02,         //   Input (Data,Var,Abs)

    // L2 Trigger (Rx), R2 Trigger (Ry) — 2 × 8-bit analog
    0x05, 0x01,         //   Usage Page (Generic Desktop Controls)
    0x09, 0x33,         //   Usage (Rx)
    0x09, 0x34,         //   Usage (Ry)
    0x15, 0x00,         //   Logical Minimum (0)
    0x26, 0xFF, 0x00,   //   Logical Maximum (255)
    0x75, 0x08,         //   Report Size (8)
    0x95, 0x02,         //   Report Count (2)
    0x81, 0x02,         //   Input (Data,Var,Abs)

    // Vendor data — 54 bytes (timestamp, IMU, touchpad, battery, etc.)
    0x06, 0x00, 0xFF,   //   Usage Page (Vendor Defined 0xFF00)
    0x09, 0x21,         //   Usage (0x21)
    0x95, 0x36,         //   Report Count (54)
    0x81, 0x02,         //   Input (Data,Var,Abs)

    // Output Report ID 0x05 — 31 bytes (rumble, LED, audio)
    0x85, 0x05,         //   Report ID (5)
    0x09, 0x22,         //   Usage (0x22)
    0x95, 0x1F,         //   Report Count (31)
    0x91, 0x02,         //   Output (Data,Var,Abs)

    // Feature Reports
    0x85, 0x04, 0x09, 0x23, 0x95, 0x24, 0xB1, 0x02,  // ID 0x04, 36 bytes
    0x85, 0x02, 0x09, 0x24, 0x95, 0x24, 0xB1, 0x02,  // ID 0x02, 36 bytes (calibration)
    0x85, 0x08, 0x09, 0x25, 0x95, 0x03, 0xB1, 0x02,  // ID 0x08, 3 bytes
    0x85, 0x10, 0x09, 0x26, 0x95, 0x04, 0xB1, 0x02,  // ID 0x10, 4 bytes
    0x85, 0x11, 0x09, 0x27, 0x95, 0x02, 0xB1, 0x02,  // ID 0x11, 2 bytes
    0x85, 0x12, 0x06, 0x02, 0xFF, 0x09, 0x21, 0x95, 0x0F, 0xB1, 0x02,  // ID 0x12, 15 bytes
    0x85, 0x13, 0x09, 0x22, 0x95, 0x16, 0xB1, 0x02,  // ID 0x13, 22 bytes
    0x85, 0x14, 0x06, 0x05, 0xFF, 0x09, 0x20, 0x95, 0x10, 0xB1, 0x02,  // ID 0x14, 16 bytes
    0x85, 0x15, 0x09, 0x21, 0x95, 0x2C, 0xB1, 0x02,  // ID 0x15, 44 bytes

    // Vendor feature reports 0x80-0x93
    0x06, 0x80, 0xFF,   //   Usage Page (Vendor Defined 0xFF80)
    0x85, 0x80, 0x09, 0x20, 0x95, 0x06, 0xB1, 0x02,  // ID 0x80, 6 bytes
    0x85, 0x81, 0x09, 0x21, 0x95, 0x06, 0xB1, 0x02,  // ID 0x81, 6 bytes (MAC address)
    0x85, 0x82, 0x09, 0x22, 0x95, 0x05, 0xB1, 0x02,  // ID 0x82, 5 bytes
    0x85, 0x83, 0x09, 0x23, 0x95, 0x01, 0xB1, 0x02,  // ID 0x83, 1 byte
    0x85, 0x84, 0x09, 0x24, 0x95, 0x04, 0xB1, 0x02,  // ID 0x84, 4 bytes
    0x85, 0x85, 0x09, 0x25, 0x95, 0x06, 0xB1, 0x02,  // ID 0x85, 6 bytes
    0x85, 0x86, 0x09, 0x26, 0x95, 0x06, 0xB1, 0x02,  // ID 0x86, 6 bytes
    0x85, 0x87, 0x09, 0x27, 0x95, 0x23, 0xB1, 0x02,  // ID 0x87, 35 bytes
    0x85, 0x88, 0x09, 0x28, 0x95, 0x22, 0xB1, 0x02,  // ID 0x88, 34 bytes
    0x85, 0x89, 0x09, 0x29, 0x95, 0x02, 0xB1, 0x02,  // ID 0x89, 2 bytes
    0x85, 0x90, 0x09, 0x30, 0x95, 0x05, 0xB1, 0x02,  // ID 0x90, 5 bytes
    0x85, 0x91, 0x09, 0x31, 0x95, 0x03, 0xB1, 0x02,  // ID 0x91, 3 bytes
    0x85, 0x92, 0x09, 0x32, 0x95, 0x03, 0xB1, 0x02,  // ID 0x92, 3 bytes
    0x85, 0x93, 0x09, 0x33, 0x95, 0x0C, 0xB1, 0x02,  // ID 0x93, 12 bytes

    // Vendor feature reports 0xA0-0xAF
    0x85, 0xA0, 0x09, 0x40, 0x95, 0x06, 0xB1, 0x02,  // ID 0xA0, 6 bytes
    0x85, 0xA1, 0x09, 0x41, 0x95, 0x01, 0xB1, 0x02,  // ID 0xA1, 1 byte
    0x85, 0xA2, 0x09, 0x42, 0x95, 0x01, 0xB1, 0x02,  // ID 0xA2, 1 byte
    0x85, 0xA3, 0x09, 0x43, 0x95, 0x30, 0xB1, 0x02,  // ID 0xA3, 48 bytes (firmware)
    0x85, 0xA4, 0x09, 0x44, 0x95, 0x0D, 0xB1, 0x02,  // ID 0xA4, 13 bytes
    0x85, 0xA5, 0x09, 0x45, 0x95, 0x15, 0xB1, 0x02,  // ID 0xA5, 21 bytes
    0x85, 0xA6, 0x09, 0x46, 0x95, 0x15, 0xB1, 0x02,  // ID 0xA6, 21 bytes
    0x85, 0xA7, 0x09, 0x4A, 0x95, 0x01, 0xB1, 0x02,  // ID 0xA7, 1 byte
    0x85, 0xA8, 0x09, 0x4B, 0x95, 0x01, 0xB1, 0x02,  // ID 0xA8, 1 byte
    0x85, 0xA9, 0x09, 0x4C, 0x95, 0x08, 0xB1, 0x02,  // ID 0xA9, 8 bytes
    0x85, 0xAA, 0x09, 0x4E, 0x95, 0x01, 0xB1, 0x02,  // ID 0xAA, 1 byte
    0x85, 0xAB, 0x09, 0x4F, 0x95, 0x39, 0xB1, 0x02,  // ID 0xAB, 57 bytes
    0x85, 0xAC, 0x09, 0x50, 0x95, 0x39, 0xB1, 0x02,  // ID 0xAC, 57 bytes
    0x85, 0xAD, 0x09, 0x51, 0x95, 0x0B, 0xB1, 0x02,  // ID 0xAD, 11 bytes
    0x85, 0xAE, 0x09, 0x52, 0x95, 0x01, 0xB1, 0x02,  // ID 0xAE, 1 byte
    0x85, 0xAF, 0x09, 0x53, 0x95, 0x02, 0xB1, 0x02,  // ID 0xAF, 2 bytes

    // Vendor feature reports 0xB0, 0xF0-0xF2
    0x85, 0xB0, 0x09, 0x54, 0x95, 0x3F, 0xB1, 0x02,  // ID 0xB0, 63 bytes
    0x85, 0xF0, 0x09, 0x47, 0x95, 0x3F, 0xB1, 0x02,  // ID 0xF0, 63 bytes
    0x85, 0xF1, 0x09, 0x48, 0x95, 0x3F, 0xB1, 0x02,  // ID 0xF1, 63 bytes
    0x85, 0xF2, 0x09, 0x49, 0x95, 0x0F, 0xB1, 0x02,  // ID 0xF2, 15 bytes

    0xC0                // End Collection
};

static const uint32_t DS4ReportDescriptorSize = sizeof(DS4ReportDescriptor);

#endif /* DS4ReportDescriptor_h */
